# Framework v0.3 Roadmap

**Based on:** First benchmark run feedback (2025-12-06)
**Status:** Planning
**Target Release:** TBD

---

## Executive Summary

**Updated:** 2025-12-06 (Post-Agent Transcript Analysis)

Benchmark run + full 18-agent transcript analysis revealed **25 considerations** with quantified evidence.

**Critical Issues:** 8 issues (60-85% token reduction + quality gates)
**High Priority:** 6 issues (debugging & user experience)
**Medium Priority:** 8 issues (quality & process improvements)
**Low Priority:** 4 issues (future enhancements)

**Key Finding:** 60-85% token reduction possible through context optimization alone.

---

## üî¥ CRITICAL - Must Fix (8 Issues)

### Phase 1: Token Optimization (Est. 60-85% Reduction)

### 1. CON-12: Agent File Content Caching
**Impact:** 30-40% token reduction possible
**Evidence:** 4.3x file redundancy (333 ops / 78 unique files)
**Action:**
- Implement per-agent file content cache (ephemeral, session-scoped)
- Add "recently read files" metadata to agent context
- Enable reference to previous reads instead of re-reading
**Effort:** Medium | **Timeline:** Week 1-2

### 2. CON-17: Command-Level Artifact Cache
**Impact:** 15-20% token reduction possible
**Evidence:** Core specs read 28 times (architecture.md: 10x, tech-stack.md: 9x, requirements.md: 9x)
**Action:**
- Load `.claude/specs/` once per command, inject into all agent contexts
- Implement artifact compression/summarization
- Add artifact versioning (hash) to detect when re-reading needed
**Effort:** Medium | **Timeline:** Week 1-2

### 3. CON-16: Bash-Heavy File Discovery
**Impact:** 10-15% token reduction possible
**Evidence:** 122 Bash commands, 60% for `ls`, `find`, `grep`
**Action:**
- Generate project file tree once per workflow
- Provide structured file manifest
- Implement FilesystemQuery tool (replace Bash discovery)
**Effort:** Low-Medium | **Timeline:** Week 2

### 4. CON-10: Token Utilization (Now Quantified)
**Impact:** Combined with above: 60-85% total reduction
**Evidence:** Agent transcript analysis quantified all token waste
**Action:**
- All of CON-12, CON-16, CON-17 above
- Model optimization (haiku for simple agents)
**Effort:** High | **Timeline:** Week 1-2

### Phase 2: Quality Gates

### 5. CON-19: No Testing Agents in Workflow
**Impact:** Quality risk - engineers testing own code
**Evidence:** 0 Tester agents in top 10, framework has tester but not invoked
**Action:**
- Make Tester agent mandatory in all implementation workflows
- Add test-first workflow variant
- Track test coverage metrics
**Effort:** Medium | **Timeline:** Week 3

### 6. CON-20: Missing Security Auditor
**Impact:** Security risk - authentication with no audit
**Evidence:** Phase 2 (JWT, passwords) implemented, 0 security-auditor agents
**Action:**
- Make security-auditor mandatory for auth/data/API phases
- Add security checklist to workflow
- Block deployment on critical findings
**Effort:** Low-Medium | **Timeline:** Week 3

### Phase 3: Framework Infrastructure

### 7. CON-02: Slash Commands Not Loading
**Impact:** Framework commands don't work out of the box
**Status:** Needs investigation
**Action:** Determine how Claude Code discovers slash commands
**Effort:** Unknown | **Timeline:** Week 1

### 8. CON-13: Explicit Agent Role Metadata
**Impact:** Cannot debug or analyze workflows
**Evidence:** 3 agents with unknown roles
**Action:**
- Add `role`, `phase`, `subtask` to agent YAML
- Export in session metadata
- Include in agent IDs (e.g., `engineer-phase2-auth`)
**Effort:** Low | **Timeline:** Week 3

---

## ‚ö†Ô∏è HIGH PRIORITY - Should Fix (6 Issues)

### 9. CON-14: Duplicate Agent Invocations
**Impact:** Cannot measure bounded reflexion effectiveness
**Evidence:** 2 agents on Phase 2 Auth (59 wasted ops)
**Action:**
- Add retry metadata to agent exports
- Track parent-child relationships
- Export retry_reason field
**Effort:** Low | **Timeline:** Week 3-4

### 10. CON-22: Error Handling Opaque
**Impact:** Cannot optimize bounded reflexion
**Evidence:** 12 error references, unclear if errors or code
**Action:**
- Structured error logging (agent_errors, tool_errors, retry_triggers)
- Export error recovery patterns
- Categorize errors (transient vs permanent)
**Effort:** Medium | **Timeline:** Week 3-4

### 11. CON-01: CLAUDE.md Auto-Population
**Impact:** Users unsure when/how to fill project documentation
**Action:** Architect agent updates CLAUDE.md after creating specs
**Effort:** Low | **Timeline:** Week 4

### 12. CON-06: Task Tracking Not Used
**Impact:** Cannot resume after session loss
**Action:**
- Commands update `.claude/plans/current-task.md`
- Create checkpoint system
- Enable resume capability
**Effort:** Medium | **Timeline:** Week 4
**Dependencies:** Required for CON-09

### 13. CON-09: Quota Limit Recovery
**Impact:** Poor UX when hitting limits
**Action:**
- Implement `/project:resume` command
- Automatic state persistence
- User documentation
**Effort:** Medium | **Timeline:** Week 4-5
**Dependencies:** Requires CON-06 first

---

## üü° MEDIUM PRIORITY - Nice to Have (8 Issues)

### Quality Improvements

### 14. CON-18: Engineer-Heavy Workflow Imbalance
**Impact:** Quality concern (8+ Engineers, minimal validation)
**Action:** Dedicated Tester and Code Reviewer per phase
**Effort:** Medium | **Timeline:** v0.3-v0.4

### 15. CON-24: No Documentation Agent
**Impact:** Maintenance concern (engineers writing docs)
**Action:** Mandatory documenter agent after each phase
**Effort:** Low | **Timeline:** v0.3

### 16. CON-25: Workflow Missing Enforced Quality Gates
**Impact:** Process concern (can skip validation)
**Action:** Phase-gating, mandatory agents based on phase type
**Effort:** Medium | **Timeline:** v0.3

### 17. CON-21: Write/Edit Imbalance
**Impact:** Quality metric (write-once-ship pattern)
**Action:** Track ratios, flag >5:1 for review
**Effort:** Low | **Timeline:** v0.4

### Process Improvements

### 18. CON-07: Git Workflow Missing
**Impact:** Cannot rollback or collaborate
**Action:** DevOps manages git, conventional commits, auto-commits per phase
**Effort:** Medium | **Timeline:** v0.3

### 19. CON-11: Code Rework Pattern
**Impact:** Token waste, inefficiency
**Action:** Architect specs only (no code), Engineer implements from specs
**Effort:** Low | **Timeline:** v0.3

### 20. CON-03: Benchmark Metrics Automation
**Impact:** Manual tracking error-prone
**Action:** Commands log to `.claude/state/*`, post-run analysis script
**Effort:** Medium | **Timeline:** v0.3-v0.4

### 21. CON-15: Minimal Agent Invocation Waste
**Impact:** Small optimization (2 agents with 1 op each)
**Action:** Pre-flight complexity check, log termination reason
**Effort:** Low | **Timeline:** v0.4

---

## üü¢ LOW PRIORITY - Future (4 Issues)

### 22. CON-23: Parallel Agent Coordination
**Impact:** Future optimization
**Action:** Add execution mode, timestamps, dependency graph
**Effort:** Medium | **Timeline:** v0.4+

### 23. CON-04: Parking Lot Features
**Impact:** Ideas get lost
**Action:** PM agent creates `.claude/plans/backlog.md`
**Effort:** Low | **Timeline:** v0.4

### 24. CON-05: Agent Time Awareness
**Impact:** Minimal (Engineer correct, inconsistent elsewhere)
**Action:** Monitor, document expected behavior
**Effort:** Low | **Timeline:** v0.4 if issues arise

### 25. CON-08: Agent Memory Location
**Impact:** Minor organizational issue
**Action:** Standardize on `.claude/specs/` for agent context
**Effort:** Low | **Timeline:** v0.4

---

## Implementation Plan

**Updated:** Based on agent transcript analysis findings
**Total Duration:** 5-6 weeks
**Phases:** 3 main phases + validation

### Phase 1: Token Optimization (Week 1-2) üéØ TOP PRIORITY

**Goal:** 60-85% token reduction
**Status:** Ready to implement

**Week 1:**
- [ ] CON-12: Implement agent file content caching
  - [ ] Design cache structure (per-agent, session-scoped)
  - [ ] Add "recently read" metadata to agent context
  - [ ] Implement cache invalidation on Write/Edit
  - [ ] Test with single agent workflow

- [ ] CON-17: Implement command-level artifact cache
  - [ ] Load `.claude/specs/` once at command start
  - [ ] Inject artifacts into all agent contexts
  - [ ] Add artifact version tracking (hash)

- [ ] CON-02: Investigate slash command loading
  - [ ] Research Claude Code command discovery
  - [ ] Test solutions
  - [ ] Document findings

**Week 2:**
- [ ] CON-16: Add file tree context provider
  - [ ] Generate project tree at workflow start
  - [ ] Create structured file manifest
  - [ ] Implement FilesystemQuery tool
  - [ ] Update agents to use tree instead of Bash

- [ ] Mini-benchmark test (subset of tasks)
  - [ ] Measure token reduction
  - [ ] Verify no regressions
  - [ ] Document improvements

**Expected Outcome:** 60-85% token reduction, sub-700 operations for full benchmark

---

### Phase 2: Quality Gates (Week 3) üõ°Ô∏è CRITICAL FOR PRODUCTION

**Goal:** Mandatory Testing + Security coverage
**Status:** Ready to implement

**Week 3:**
- [ ] CON-19: Make Tester agent mandatory
  - [ ] Update commands to invoke Tester after each implementation
  - [ ] Create test-first workflow variant
  - [ ] Add test coverage tracking
  - [ ] Update `.claude/commands/*.md` with Tester integration

- [ ] CON-20: Make Security Auditor mandatory
  - [ ] Identify phases needing security (auth, data, API)
  - [ ] Add security-auditor to workflow
  - [ ] Create security checklist
  - [ ] Add blocking on critical findings

- [ ] CON-13: Add agent role metadata
  - [ ] Update all agent YAML with `role` field
  - [ ] Export role in session metadata
  - [ ] Include role in agent IDs
  - [ ] Test session export with roles

**Expected Outcome:** 100% Testing + Security coverage, role-based analysis enabled

---

### Phase 3: Metadata & Tracking (Week 4) üìä DEBUGGING ENABLEMENT

**Goal:** Complete observability and resume capability
**Status:** Ready to implement

**Week 4:**
- [ ] CON-14: Add retry tracking metadata
  - [ ] Export retry_reason, parent agent, retry counter
  - [ ] Track parent-child agent relationships
  - [ ] Test bounded reflexion tracking

- [ ] CON-22: Structured error logging
  - [ ] Implement agent_errors, tool_errors, retry_triggers
  - [ ] Export error recovery patterns
  - [ ] Add error categorization

- [ ] CON-06: Task tracking system
  - [ ] Update commands to write to current-task.md
  - [ ] Create checkpoint system
  - [ ] Add workflow state persistence

- [ ] CON-01: Auto-populate CLAUDE.md
  - [ ] Architect updates CLAUDE.md after specs
  - [ ] Test with `/project:start`

**Expected Outcome:** Full session observability, resume capability foundation

---

### Phase 4: Validation & Release (Week 5-6) ‚úÖ

**Week 5:**
- [ ] CON-09: Implement `/project:resume` command
  - [ ] Read state from current-task.md
  - [ ] Show resume point to user
  - [ ] Continue workflow from checkpoint
  - [ ] Document usage

- [ ] Full benchmark comparison
  - [ ] Run identical task with v0.3
  - [ ] Measure all metrics vs v0.2
  - [ ] Document improvements
  - [ ] Verify success criteria

**Week 6:**
- [ ] Documentation updates
  - [ ] Update CLAUDE.md with v0.3 features
  - [ ] Update benchmark guide
  - [ ] Create migration guide (v0.2 ‚Üí v0.3)
  - [ ] Update all agent/command docs

- [ ] Release preparation
  - [ ] Tag v0.3 release
  - [ ] Create release notes
  - [ ] Update README
  - [ ] Announce improvements

**Expected Outcome:** v0.3 release with quantified improvements

---

## Success Criteria for v0.3

A successful v0.3 release requires meeting quantified targets from agent transcript analysis.

### Token Efficiency (CRITICAL - Must Achieve)
- ‚úÖ **Operations reduced by ‚â•60%** (1,179 ‚Üí <470)
  - Baseline: 1,179 operations
  - Target: <470 operations (60% reduction minimum)
  - Stretch: <300 operations (75% reduction)

- ‚úÖ **File redundancy <1.5x** (currently 4.3x)
  - Baseline: 4.3x redundancy (333 ops / 78 files)
  - Target: <1.5x (max 117 ops for 78 files)

- ‚úÖ **Bash discovery reduced by ‚â•50%** (currently 122)
  - Baseline: 122 Bash commands, 60% for file discovery
  - Target: <60 Bash commands total

- ‚úÖ **Spec re-reads eliminated**
  - Baseline: 28 redundant reads (architecture.md: 10x, tech-stack.md: 9x, requirements.md: 9x)
  - Target: 3 reads total (1x each, cached for all agents)

### Quality Coverage (CRITICAL - Must Achieve)
- ‚úÖ **100% of implementation phases have Tester agent**
  - Baseline: 0 Tester agents in top 10
  - Target: ‚â•1 Tester agent per implementation phase

- ‚úÖ **100% of auth/data phases have Security Auditor**
  - Baseline: 0 security-auditor agents (Phase 2 auth had none)
  - Target: Security audit for all sensitive phases

- ‚úÖ **Test coverage >80%**
  - Measure: Code coverage from generated tests
  - Target: >80% line coverage

### Metadata Completeness (CRITICAL - Must Achieve)
- ‚úÖ **100% of agents have role metadata**
  - Baseline: 3 agents with unknown roles
  - Target: All agents export role, phase, subtask

- ‚úÖ **All retries tracked with reason**
  - Baseline: No retry tracking (CON-14)
  - Target: Every retry logged with parent agent + reason

- ‚úÖ **All errors categorized and logged**
  - Baseline: Opaque error handling (CON-22)
  - Target: Structured error logging (agent_errors, tool_errors, retry_triggers)

### User Experience (HIGH - Should Achieve)
- ‚úÖ **Resume capability works**
  - Baseline: Cannot resume after quota limit
  - Target: `/project:resume` command functional

- ‚úÖ **Task tracking persists**
  - Baseline: No task tracking (CON-06)
  - Target: current-task.md updated by all commands

- ‚úÖ **CLAUDE.md auto-populated**
  - Baseline: Manual user filling required
  - Target: Architect populates after specs created

### Workflow Balance (MEDIUM - Nice to Have)
- ‚úÖ **Engineer:Tester ratio ‚âà1:1 per phase**
  - Baseline: 8+ Engineers, 0 Testers
  - Target: Balanced ratio

- ‚úÖ **Documentation agent per phase**
  - Baseline: 0 documenter agents
  - Target: ‚â•1 documenter per major phase

- ‚úÖ **Git commits per phase**
  - Baseline: Ad-hoc commits
  - Target: Systematic commits with conventional messages

### No Regressions
- ‚úÖ All v0.2 tests still pass
- ‚úÖ All v0.2 features still work
- ‚úÖ Benchmark completion time same or better

---

## Risk Assessment

### High Risk
- **CON-02 (Slash commands)**: May require Claude Code core changes
  - Mitigation: Investigate early, have fallback plan

- **CON-10 (Token usage)**: May require significant refactoring
  - Mitigation: Profile first, prioritize high-impact changes

### Medium Risk
- **CON-06 (Task tracking)**: Complex state management
  - Mitigation: Start simple, iterate

- **CON-09 (Resume)**: Depends on CON-06
  - Mitigation: Clear dependency chain

### Low Risk
- All other issues have clear solutions

---

## Open Questions

1. **Slash Commands (CON-02)**
   - Q: How does Claude Code discover commands?
   - A: [To be determined through investigation]

2. **Token Budget (CON-10)**
   - Q: What is acceptable token usage for full benchmark?
   - Current: [Measure from run 1]
   - Target: [TBD - 40% reduction?]

3. **State Format (CON-06)**
   - Q: JSON or Markdown for state files?
   - Recommendation: Markdown (human-readable, git-friendly)

4. **CLAUDE.md Ownership (CON-01)**
   - Q: Auto-update or user-edit?
   - Recommendation: Auto-update, allow user override

5. **Code Creation Boundary (CON-11)**
   - Q: Should PM/Architect create ANY code?
   - Recommendation: No - specs only

---

## Metrics to Track

### Before v0.3 (Baseline from v0.2)
- Token usage: [X tokens for full benchmark]
- Time to complete: [Y hours]
- User interventions: [Z count]
- Resume capability: ‚ùå Not possible
- Slash commands: ‚ùå Manual discovery required

### After v0.3 (Targets)
- Token usage: ‚â§60% of baseline
- Time to complete: Same or better
- User interventions: ‚â§70% of baseline
- Resume capability: ‚úÖ Works
- Slash commands: ‚úÖ Auto-loaded

---

## Communication Plan

### Stakeholders
- Framework users (benchmark testers)
- Framework developers
- Documentation team

### Updates
- Weekly: Progress update on critical issues
- Milestone: When each phase completes
- Release: v0.3 announcement with improvements

---

## Rollback Plan

If v0.3 introduces regressions:

1. **Identify regression** through benchmark
2. **Assess severity**:
   - Critical: Rollback immediately to v0.2
   - High: Fix forward in v0.3.1
   - Medium: Document workaround, fix in v0.3.1
3. **Preserve learnings** in benchmark-learnings.md
4. **Re-test** before re-release

---

## Resources Needed

- **Development Time**: 5-6 weeks (3 implementation phases + validation)
- **Testing Time**: 3-4 full benchmark runs
- **Documentation Time**: 1 week
- **Tools**: Claude Code, Docker, Git, Python (for automation), jq (for session analysis)

---

## Next Actions

**Immediate (Week 1):**
1. ‚úÖ Document all considerations (DONE - benchmark-learnings.md updated with CON-01 through CON-25)
2. ‚úÖ Complete agent transcript analysis (DONE - session-exports/20251206-194845/)
3. ‚úÖ Update v0.3 roadmap (DONE - this file)
4. ‚è≥ Begin CON-12 implementation (agent file content caching)
5. ‚è≥ Begin CON-17 implementation (command-level artifact cache)
6. ‚è≥ Investigate slash command mechanism (CON-02)

**This Week (Week 2):**
1. ‚è≥ Complete Phase 1: Token Optimization
2. ‚è≥ Run mini-benchmark to validate improvements
3. ‚è≥ Measure token reduction achieved

**Next Weeks:**
- Week 3: Phase 2 (Quality Gates)
- Week 4: Phase 3 (Metadata & Tracking)
- Week 5-6: Validation & Release

**Owner:** Framework Team
**Status:** Ready to begin implementation

---

## Summary

**v0.3 Goals:**
- 60-85% token reduction through context optimization
- 100% Testing and Security coverage
- Complete observability and debugging capability
- Resume capability after interruptions

**Evidence-Based Approach:**
All improvements backed by quantified data from 18-agent transcript analysis:
- 4.3x file redundancy measured
- 122 Bash commands counted
- 28 redundant spec reads documented
- 0 Tester agents observed
- 0 Security auditor agents found

**Expected Impact:**
- Operations: 1,179 ‚Üí <470 (60% reduction minimum)
- Cost reduction: Proportional to operation reduction
- Quality improvement: Mandatory Testing + Security
- Developer experience: Resume capability, better debugging

---

**Document Version:** 2.0 (Updated with agent transcript analysis)
**Last Updated:** 2025-12-06 20:15
**Next Review:** After Phase 1 completion (Week 2)
**Analysis Source:** session-exports/20251206-194845/FRAMEWORK-IMPROVEMENT-ANALYSIS.md
