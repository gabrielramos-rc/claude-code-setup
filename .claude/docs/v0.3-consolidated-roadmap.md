# Framework v0.3 Consolidated Feature Roadmap

**Created:** 2025-12-06
**Status:** Ready for Implementation
**Source:** Consolidated analysis of 25 considerations from benchmark run + agent transcript analysis

---

## Executive Summary

This consolidated roadmap addresses **25 identified considerations** (CON-01 through CON-25) discovered through comprehensive benchmark testing and agent transcript analysis. All issues have been grouped by theme, prioritized by impact, and paired with concrete solutions.

### Impact Summary

**Token Efficiency (60-85% reduction possible):**
- Agent file caching: 30-40% reduction
- Command-level artifact cache: 15-20% reduction
- File discovery optimization: 10-15% reduction

**Quality Gaps (CRITICAL):**
- 0 Testing agents → 100% coverage required
- 0 Security auditor agents → Mandatory for auth/data phases
- Engineer-heavy workflow → Balanced multi-role approach

**User Experience:**
- No resume capability → Full checkpoint system
- Opaque debugging → Complete metadata export
- Manual processes → Automated workflows

---

## Issue Consolidation by Theme

### Theme 1: TOKEN EFFICIENCY (60-85% reduction potential)

**6 considerations addressing context waste and redundant operations**

#### CON-10: Token Utilization Optimization (CRITICAL)
- **Problem:** Framework using tokens inefficiently across multiple dimensions
- **Evidence:** Baseline 1,179 operations for benchmark task
- **Root Causes:** CON-12, CON-16, CON-17 (detailed below)

#### CON-12: Agent File Content Caching (CRITICAL)
- **Problem:** Agents re-read same files multiple times, even within single session
- **Evidence:** 4.3x file redundancy (333 file ops / 78 unique files)
- **Example:** agent-4a328c96 read user.repository.ts twice in same session
- **Impact:** 30-40% token waste

#### CON-17: Command-Level Artifact Cache Not Working (CRITICAL)
- **Problem:** v0.2 artifact priority system not preventing redundant spec reads
- **Evidence:** Core specs read 28 times (architecture.md: 10x, tech-stack.md: 9x, requirements.md: 9x)
- **Impact:** 15-20% token waste

#### CON-16: Bash-Heavy File Discovery Anti-Pattern (HIGH)
- **Problem:** Agents use expensive Bash commands for file discovery
- **Evidence:** 122 Bash commands, 60% for ls/find/grep
- **Example:** agent-4a328c96 ran 42 Bash commands mostly for file location
- **Impact:** 10-15% token waste

#### CON-11: Rework and Code Deletion Pattern (MEDIUM)
- **Problem:** PM/Architect create code early, Engineer deletes and rebuilds later
- **Evidence:** Draft authentication code created in planning, deleted in Phase 1, recreated in Phase 2
- **Impact:** Wasted tokens recreating code

#### CON-23: Parallel Agent Coordination Unknown (LOW)
- **Problem:** Cannot determine if agents ran in parallel or had conflicts
- **Evidence:** agent-af41e798 and agent-8495e060 both had 33 identical operations
- **Impact:** Future optimization opportunity

**Consolidated Solution → Feature Package #1: Context Optimization System**

---

### Theme 2: QUALITY GATES (Critical gaps in production readiness)

**5 considerations addressing missing validation and security**

#### CON-19: No Testing Agents in Workflow (CRITICAL)
- **Problem:** Engineers test their own code, no independent validation
- **Evidence:** Top 10 agents: 8 Engineers, 0 Testers
- **Impact:** Quality risk, missed edge cases, inadequate coverage

#### CON-20: Missing Security Auditor Agent (CRITICAL)
- **Problem:** Authentication implemented with no security review
- **Evidence:** Phase 2 (JWT, passwords) completed, 0 security-auditor agents invoked
- **Impact:** Security vulnerabilities may exist

#### CON-18: Engineer-Heavy Workflow Imbalance (MEDIUM)
- **Problem:** 8+ Engineer agents, minimal validation agents
- **Evidence:** Top 10 all engineers except 1 architect
- **Impact:** Quality concern, insufficient checks

#### CON-24: No Documentation Agent Evidence (MEDIUM)
- **Problem:** Phase 4 production readiness without dedicated documenter
- **Evidence:** Framework has documenter agent but wasn't invoked
- **Impact:** Maintenance concern, docs written by engineers

#### CON-25: Workflow Missing Enforced Quality Gates (MEDIUM)
- **Problem:** Workflow allows sequential execution without mandatory validation
- **Evidence:** Can proceed through phases without testing/security review
- **Impact:** Process concern, quality bypassed

**Consolidated Solution → Feature Package #2: Mandatory Quality Gate System**

---

### Theme 3: OBSERVABILITY & DEBUGGING (Cannot optimize what we can't see)

**5 considerations addressing metadata and tracking**

#### CON-13: Explicit Agent Role Metadata (CRITICAL)
- **Problem:** Agent roles cannot be identified from transcripts
- **Evidence:** agent-2cd490d2: 42 ops, 0 reads, 19 writes - role unknown
- **Impact:** Debugging impossible, cannot analyze workflows

#### CON-14: Duplicate Agent Invocations (HIGH)
- **Problem:** Multiple agents worked on same phase, unclear if retry
- **Evidence:** agent-4ed9b522 (59 ops) + agent-4a328c96 (238 ops) both on Phase 2
- **Impact:** 59 potentially wasted operations, retry effectiveness unknown

#### CON-22: Error Handling Opaque (HIGH)
- **Problem:** Cannot distinguish encountered errors from error-handling code
- **Evidence:** agent-2cd490d2 had 12 error references, unclear context
- **Impact:** Cannot optimize bounded reflexion

#### CON-15: Minimal Agent Invocation Waste (MEDIUM)
- **Problem:** 2 agents performed only 1 operation each
- **Evidence:** agent-00a0149e and agent-c42525e1 each did 1 operation
- **Impact:** Wasted agent invocation overhead

#### CON-21: Write vs Edit Imbalance (MEDIUM)
- **Problem:** High Write/Edit ratios suggest "write once, ship" pattern
- **Evidence:** agent-58e69205: 37 Writes, 3 Edits (12:1 ratio)
- **Impact:** Quality metric, insufficient refinement

**Consolidated Solution → Feature Package #3: Complete Observability System**

---

### Theme 4: USER EXPERIENCE (Session management and workflow)

**5 considerations addressing interruptions and automation**

#### CON-06: Task Tracking - Plans Directory Unused (HIGH)
- **Problem:** Agents never used .claude/plans/* files, cannot resume
- **Evidence:** .claude/plans/current-task.md exists but unused
- **Impact:** Session loss = start from scratch

#### CON-09: Agent Quota Limit Recovery (HIGH)
- **Problem:** When hitting quota limit, unclear how to resume
- **Evidence:** No resume mechanism exists
- **Impact:** Poor UX, lost progress

#### CON-01: CLAUDE.md File Initialization (HIGH)
- **Problem:** CLAUDE.md sections empty from template, unclear when to fill
- **Evidence:** OBS-01 showed Engineer updated it (self-initiated)
- **Impact:** Confusion on when/how to populate project docs

#### CON-03: Benchmark Metric Tracking Automation (MEDIUM)
- **Problem:** Manual tracking of benchmark metrics is error-prone
- **Evidence:** Human manually counts retries, interventions, scores
- **Impact:** Easy to miss or miscount events

#### CON-07: Version Control & Git Conventions (MEDIUM)
- **Problem:** Agents used git locally but no systematic commits to remote
- **Evidence:** No commit message conventions, no branch strategy
- **Impact:** Cannot rollback, share progress, or collaborate

**Consolidated Solution → Feature Package #4: Session Management & Automation**

---

### Theme 5: FRAMEWORK INFRASTRUCTURE (Core functionality)

**4 considerations addressing framework setup and patterns**

#### CON-02: Slash Commands Not Auto-Loaded (CRITICAL)
- **Problem:** Custom slash commands don't work out of the box
- **Evidence:** Error "Unknown slash command: project:route"
- **Impact:** Framework commands unusable, blocks all workflows

#### CON-08: Agent Memory Organization (LOW)
- **Problem:** Engineer created PROJECT_INITIALIZATION_SUMMARY.md in root, unclear if standard
- **Evidence:** Unclear where agent memory should live
- **Impact:** Organizational inconsistency

#### CON-04: Parking Lot Requirements (LOW)
- **Problem:** PM created "Open Questions" with no tracking mechanism
- **Evidence:** Questions live in planning docs, easy to lose
- **Impact:** Future features forgotten

#### CON-05: Agent Time Awareness (LOW)
- **Problem:** Agents sometimes think they're in 2024 vs 2025
- **Evidence:** Engineer correctly knew 2025, inconsistent elsewhere
- **Impact:** May recommend outdated packages/practices

**Consolidated Solution → Feature Package #5: Framework Foundation Fixes**

---

## Concrete Solutions: Feature Packages

### Feature Package #1: Context Optimization System
**Goal:** 60-85% token reduction through intelligent caching and context management

#### Solution 1.1: Agent File Content Cache (CON-12)
**Implementation:**
```yaml
# Add to agent execution runtime
agent_context:
  file_cache:
    enabled: true
    scope: session  # Per-agent, ephemeral
    max_size: 50MB
    invalidate_on: [Write, Edit]

  recently_read:
    - path: "src/user.repository.ts"
      message_id: 42
      hash: "abc123"
      summary: "User repository with CRUD operations"
```

**Integration Points:**
- Read tool checks cache before file access
- Cache cleared on Write/Edit to same file
- "Recently read" metadata passed to agent context
- Agent can reference "content from message #42" instead of re-reading

**Success Metric:** File redundancy <1.5x (currently 4.3x)

#### Solution 1.2: Command-Level Artifact Cache (CON-17)
**Implementation:**
```typescript
// In command execution
class CommandExecutor {
  async executeCommand(command: string) {
    // Load artifacts ONCE at command start
    const artifacts = await this.loadArtifacts([
      '.claude/specs/architecture.md',
      '.claude/specs/tech-stack.md',
      '.claude/specs/requirements.md'
    ]);

    // Compress for efficient passing
    const artifactSummary = await this.compressArtifacts(artifacts);

    // Inject into ALL agent contexts
    for (const agent of this.agents) {
      agent.injectContext({
        artifacts: artifactSummary,
        artifact_versions: this.getVersionHashes(artifacts)
      });
    }
  }
}
```

**Features:**
- Artifacts loaded once per command
- Compression/summarization for large specs
- Version tracking (hash) to detect when re-reading needed
- Explicit "inherited context" field in agent metadata

**Success Metric:** Core specs read max 3 times total (1x each), not 28 times

#### Solution 1.3: File Tree Context Provider (CON-16)
**Implementation:**
```typescript
// Generate once per workflow
interface ProjectManifest {
  tree: string;  // Full directory tree
  patterns: {
    controllers: string[];    // All controller files
    routes: string[];        // All route files
    middleware: string[];    // All middleware files
    models: string[];        // All model files
    tests: string[];         // All test files
  };
  metadata: {
    total_files: number;
    last_updated: Date;
  };
}

// Inject into agent context
agent_context.project_manifest = generateManifest();
```

**Tool Replacement:**
- Replace `ls -la /path/to/src/controllers/`
- With: agent references `project_manifest.patterns.controllers`
- Replace `find /path/to/src -name "auth.*"`
- With: FilesystemQuery tool using in-memory manifest

**Success Metric:** Bash file discovery commands reduced by 50% (122 → <60)

#### Solution 1.4: Architect Specs-Only Pattern (CON-11)
**Implementation:**
```yaml
# Update .claude/agents/architect.md
---
name: architect
constraints:
  - "Create ONLY specification documents, NEVER code files"
  - "Output: architecture.md, tech-stack.md, NOT .ts/.js files"
  - "Use pseudocode in specs, let Engineer translate to real code"
---
```

**Workflow Change:**
- Architect: Creates detailed pseudocode in architecture.md
- Engineer: Translates pseudocode to actual code (no deletion needed)
- Pseudocode stays in artifact as reference

**Success Metric:** Zero code files deleted/recreated between phases

**Estimated Combined Impact:** 60-85% token reduction

---

### Feature Package #2: Mandatory Quality Gate System
**Goal:** 100% Testing + Security coverage for production-ready software

#### Solution 2.1: Mandatory Tester Agent (CON-19)
**Implementation:**
```markdown
# Update all .claude/commands/*-implement.md

## Phase Workflow

1. Architect: Design technical solution
2. **Tester: Design test cases FIRST** (test-driven)
3. Engineer: Implement to pass tests
4. **Tester: Validate implementation** (independent validation)
5. Code Reviewer: Review quality
6. [Human gate: approve or retry]
```

**Agent Creation:**
```yaml
# .claude/agents/tester.md
---
name: tester
description: >
  Dedicated testing specialist. Use PROACTIVELY after any implementation phase.
  Design tests BEFORE engineering starts (test-driven).
  Validate implementation AFTER engineering completes.
model: sonnet
tools: [Bash, Read, Write]
---

You are a dedicated Testing Specialist for production-ready software.

## Responsibilities

**Test-First Phase:**
1. Read requirements and architecture specs
2. Design comprehensive test cases covering:
   - Happy path scenarios
   - Edge cases
   - Error conditions
   - Performance requirements
3. Write test stubs (failing tests) for Engineer to pass

**Validation Phase:**
1. Execute all tests
2. Measure code coverage (target: >80%)
3. Validate against acceptance criteria
4. Report: PASS/FAIL with coverage metrics

## Output Format

Create `.claude/specs/test-strategy-[phase].md`:
- Test cases designed
- Coverage expectations
- Validation results
```

**Enforcement:**
- Commands cannot proceed without Tester invocation
- Test coverage <80% triggers bounded reflexion retry
- Export test coverage in session metadata

**Success Metric:** 100% of implementation phases have dedicated Tester agent

#### Solution 2.2: Mandatory Security Auditor (CON-20)
**Implementation:**
```typescript
// Add to command routing logic
interface PhaseConfig {
  requiresSecurityAudit: boolean;
}

const SECURITY_REQUIRED_PATTERNS = [
  'auth', 'authentication', 'password', 'jwt', 'token',
  'user', 'data', 'api', 'external', 'payment', 'sensitive'
];

function requiresSecurityAudit(phase: Phase): boolean {
  const description = phase.description.toLowerCase();
  return SECURITY_REQUIRED_PATTERNS.some(pattern =>
    description.includes(pattern)
  );
}

// In command execution
if (requiresSecurityAudit(currentPhase)) {
  await invokeAgent('security-auditor', {
    phase: currentPhase,
    blockOnCritical: true  // Cannot proceed if critical findings
  });
}
```

**Security Checklist:**
```markdown
# .claude/agents/security-auditor.md

## Security Audit Checklist

**Authentication/Authorization:**
- [ ] Password hashing (bcrypt, min 12 rounds)
- [ ] JWT secret is strong and configurable
- [ ] Token expiration implemented
- [ ] No credentials in code/logs
- [ ] Rate limiting on auth endpoints

**Data Protection:**
- [ ] Input validation on all endpoints
- [ ] SQL injection prevention (parameterized queries)
- [ ] XSS prevention (output encoding)
- [ ] CSRF protection for state-changing ops
- [ ] Sensitive data encrypted at rest

**API Security:**
- [ ] HTTPS enforced
- [ ] CORS properly configured
- [ ] API keys/tokens secured
- [ ] No excessive data exposure

**Severity Levels:**
- CRITICAL: Block deployment, must fix
- HIGH: Should fix before release
- MEDIUM: Address in near-term
- LOW: Consider for future improvement
```

**Enforcement:**
- Security audit mandatory for auth/data/API phases
- Critical findings block progression
- Export audit results with severity levels

**Success Metric:** 100% of auth/data phases have Security Auditor, 0 critical findings

#### Solution 2.3: Enforced Quality Gates (CON-25)
**Implementation:**
```typescript
// Phase gating system
interface PhaseGate {
  phase: string;
  requiredAgents: AgentRole[];
  passingCriteria: Criteria[];
}

const QUALITY_GATES: PhaseGate[] = [
  {
    phase: 'implementation',
    requiredAgents: ['architect', 'tester', 'engineer', 'tester', 'code-reviewer'],
    passingCriteria: [
      { type: 'test_coverage', threshold: 80 },
      { type: 'tests_passing', threshold: 100 },
      { type: 'no_critical_security', threshold: 0 }
    ]
  },
  {
    phase: 'auth_implementation',
    requiredAgents: ['architect', 'tester', 'engineer', 'tester', 'security-auditor', 'code-reviewer'],
    passingCriteria: [
      { type: 'test_coverage', threshold: 90 },
      { type: 'security_audit_passed', threshold: true }
    ]
  }
];
```

**Success Metric:** Cannot skip validation agents in workflow

---

### Feature Package #3: Complete Observability System
**Goal:** 100% metadata export for debugging and optimization

#### Solution 3.1: Explicit Agent Role Metadata (CON-13)
**Implementation:**
```yaml
# Update ALL agent .md files with explicit metadata
---
name: engineer
role: implementation          # NEW: Explicit role classification
description: Implementation specialist
model: sonnet
tools: [Bash, Read, Write, Edit]
---

# Export in session data
{
  "agent_id": "agent-4a328c96",
  "slug": "engineer-phase2-auth",  # NEW: Human-readable identifier
  "metadata": {
    "role": "implementation",      # NEW
    "phase": "Phase 2",            # NEW
    "subtask": "Authentication",   # NEW
    "parent_agent": null,          # NEW: For retry tracking
    "retry_count": 0               # NEW
  },
  "operations": 238
}
```

**Role Taxonomy:**
```typescript
type AgentRole =
  | 'planning'           // PM, requirements gathering
  | 'architecture'       // Technical design
  | 'implementation'     // Engineer, code writing
  | 'testing'           // Test design, validation
  | 'review'            // Code review, quality
  | 'security'          // Security audit
  | 'documentation'     // Docs generation
  | 'infrastructure'    // Setup, scaffolding
  | 'devops'            // Deployment, CI/CD
  | 'validation';       // Acceptance criteria checking
```

**Success Metric:** 100% of agents have identifiable roles in exports

#### Solution 3.2: Retry Tracking System (CON-14)
**Implementation:**
```typescript
// Enhanced retry metadata
interface AgentRetryMetadata {
  is_retry: boolean;
  parent_agent_id?: string;
  retry_count: number;
  retry_reason: 'test_failure' | 'build_error' | 'validation_failed' | 'user_requested';
  previous_attempt_summary: string;
  bounded_reflexion_state: {
    command_retries: number;  // Retries for this command
    global_retries: number;   // Total across workflow
  };
}

// Export in session
{
  "agent_id": "agent-4a328c96",
  "slug": "engineer-phase2-auth-retry1",
  "retry_metadata": {
    "is_retry": true,
    "parent_agent_id": "agent-4ed9b522",
    "retry_count": 1,
    "retry_reason": "test_failure",
    "previous_attempt_summary": "Tests failed on JWT validation",
    "bounded_reflexion_state": {
      "command_retries": 1,
      "global_retries": 2
    }
  }
}
```

**Success Metric:** All retries tracked with reason and parent relationship

#### Solution 3.3: Structured Error Logging (CON-22)
**Implementation:**
```typescript
// Separate error categories in export
interface AgentErrorLog {
  agent_errors: Array<{
    timestamp: Date;
    error_type: string;
    message: string;
    recovery_action: string;
  }>;

  tool_errors: Array<{
    tool: 'Bash' | 'Read' | 'Write' | 'Edit';
    command: string;
    exit_code?: number;
    stderr?: string;
    recovery_action: string;
  }>;

  retry_triggers: Array<{
    trigger: 'test_failure' | 'build_error' | 'validation_failed';
    details: string;
    retry_decision: 'retry' | 'escalate' | 'abort';
  }>;
}

// Export in session
{
  "agent_id": "agent-2cd490d2",
  "error_log": {
    "agent_errors": [
      {
        "timestamp": "2025-12-06T14:30:00Z",
        "error_type": "ValidationError",
        "message": "User input validation failed",
        "recovery_action": "Added input sanitization"
      }
    ],
    "tool_errors": [
      {
        "tool": "Bash",
        "command": "npm run test",
        "exit_code": 1,
        "stderr": "3 tests failed",
        "recovery_action": "Fixed test assertions"
      }
    ],
    "retry_triggers": [
      {
        "trigger": "test_failure",
        "details": "Authentication tests failing",
        "retry_decision": "retry"
      }
    ]
  }
}
```

**Success Metric:** All errors categorized and recovery actions logged

#### Solution 3.4: Agent Invocation Metrics (CON-15, CON-21)
**Implementation:**
```typescript
// Track agent efficiency metrics
interface AgentEfficiencyMetrics {
  operation_count: number;
  efficiency_flags: string[];  // Warnings about unusual patterns
  tool_usage_ratio: {
    reads: number;
    writes: number;
    edits: number;
    bash: number;
  };
  quality_indicators: {
    write_edit_ratio: number;  // Track refinement
    bash_discovery_count: number;  // File discovery smell
    minimal_operation_flag: boolean;  // <5 operations warning
  };
}

// Automatic flagging
if (agent.operations < 5) {
  agent.efficiency_flags.push('MINIMAL_OPS: Agent may be prematurely invoked');
}

if (agent.write_edit_ratio > 5) {
  agent.efficiency_flags.push('HIGH_WRITE_EDIT: Insufficient refinement detected');
}
```

**Success Metric:** All efficiency anomalies flagged in exports

---

### Feature Package #4: Session Management & Automation
**Goal:** Resume capability and automated workflows

#### Solution 4.1: Task Tracking & Checkpointing System (CON-06, CON-09)
**Implementation:**
```markdown
# .claude/plans/current-task.md (Auto-updated by commands)

## Current Task
**Command:** /project:implement
**Phase:** Phase 2 - Authentication
**Status:** IN_PROGRESS
**Progress:** 60%
**Last Updated:** 2025-12-06 14:30:00

## Checkpoint
**Last Completed Step:** Implemented JWT middleware
**Next Step:** Write authentication tests
**Files Modified:**
- src/auth/jwt.ts (created)
- src/middleware/auth.ts (created)
- tests/auth.test.ts (in progress)

## Agent History
1. architect-phase2 (completed) - Designed auth architecture
2. engineer-phase2-attempt1 (failed) - Tests failed on JWT
3. engineer-phase2-attempt2 (in-progress) - Fixing JWT validation

## Retry State
**Command Retries:** 1
**Global Retries:** 2
**Max Allowed:** 5

## Resume Instructions
If session interrupted, run:
```bash
/project:resume
```

Claude will:
1. Read this file
2. Show you current progress
3. Ask if you want to continue from "Write authentication tests"
```

**Command Updates:**
```typescript
// Every command updates current-task.md
async function executeCommand(command: string) {
  // At start
  await updateTaskFile({
    status: 'IN_PROGRESS',
    command: command,
    started_at: new Date()
  });

  // After each major step
  await updateTaskFile({
    last_completed_step: step.description,
    next_step: nextStep.description,
    files_modified: changedFiles
  });

  // On completion
  await updateTaskFile({
    status: 'COMPLETED',
    completed_at: new Date()
  });

  // On failure
  await updateTaskFile({
    status: 'FAILED',
    error: error.message,
    retry_count: retryCount
  });
}
```

**Success Metric:** Can resume from any point after interruption

#### Solution 4.2: Resume Command (CON-09)
**Implementation:**
```markdown
# .claude/commands/resume.md
---
You are resuming a previously interrupted workflow.

## Steps

1. Read `.claude/plans/current-task.md`
2. Show user:
   ```
   Last session was working on: [command]
   Current phase: [phase]
   Progress: [X%]
   Last completed: [step]
   Next step: [step]
   ```
3. Ask user: "Resume from here? (y/n)"
4. If yes:
   - Load context from `.claude/specs/*`
   - Read files listed in "Files Modified"
   - Continue from "Next Step"
5. If no:
   - Ask what they'd like to do instead

## Context Loading

Read and inject:
- `.claude/specs/architecture.md`
- `.claude/specs/requirements.md`
- `.claude/specs/tech-stack.md`
- All files in "Files Modified" list

This gives you full context without re-exploration.
```

**Success Metric:** Seamless resume after quota limit or interruption

#### Solution 4.3: CLAUDE.md Auto-Population (CON-01)
**Implementation:**
```markdown
# Update .claude/commands/start.md

## Step 4: Populate CLAUDE.md

After Architect creates specifications, invoke Architect again to update CLAUDE.md:

**Architect Task:**
1. Read:
   - `.claude/specs/requirements.md`
   - `.claude/specs/architecture.md`
   - `.claude/specs/tech-stack.md`
2. Update `CLAUDE.md` sections:
   - **Overview:** Summary from requirements.md
   - **Technology Stack:** From tech-stack.md
   - **Project Structure:** From architecture.md
3. Commit: `git commit -m "docs: auto-populate CLAUDE.md from specs"`

This ensures project documentation is always synchronized with specifications.
```

**Success Metric:** CLAUDE.md automatically filled after /project:start

#### Solution 4.4: Automated Metrics & Git Workflow (CON-03, CON-07)
**Implementation:**
```yaml
# .claude/state/workflow-metrics.json (Auto-updated)
{
  "session_id": "benchmark-2025-12-06",
  "command_history": [
    {
      "command": "/project:route",
      "timestamp": "2025-12-06T14:00:00Z",
      "routing_decision": "feature",
      "complexity": "medium"
    },
    {
      "command": "/project:implement",
      "phase": "Phase 2",
      "agents_invoked": ["architect", "tester", "engineer", "tester"],
      "retries": 1,
      "interventions": 0,
      "test_coverage": 85
    }
  ],
  "cumulative_metrics": {
    "total_retries": 2,
    "total_interventions": 0,
    "phases_completed": 2,
    "test_coverage_avg": 83
  }
}
```

**Git Automation:**
```markdown
# Update .claude/agents/devops.md

## Responsibilities (NEW)

**Git Workflow Management:**
1. After each phase completion:
   - `git add .`
   - `git commit -m "feat(phase-X): [description]"` (conventional commits)
   - Ask user: "Push to remote? (y/n)"

2. Branch strategy:
   - Create feature branch per major feature
   - Commit per phase with descriptive messages
   - Tag releases (v0.1.0, v0.2.0)

3. Commit conventions:
   - feat: New feature
   - fix: Bug fix
   - test: Add tests
   - docs: Documentation
   - refactor: Code refactor
   - chore: Maintenance
```

**Success Metric:** Automated metric tracking, systematic git commits

---

### Feature Package #5: Framework Foundation Fixes
**Goal:** Core infrastructure improvements

#### Solution 5.1: Slash Command Auto-Loading (CON-02)
**Investigation Required:**
```markdown
# .claude/docs/slash-command-investigation.md

## Investigation Plan

1. Test current Claude Code command discovery:
   - Are commands discovered from `.claude/commands/*.md`?
   - Is there a manifest file needed?
   - Do commands need specific naming convention?

2. Potential solutions:

   **Option A: Command Manifest**
   Create `.claude/commands.json`:
   ```json
   {
     "commands": [
       {
         "name": "project:route",
         "file": ".claude/commands/route.md",
         "description": "Analyze task complexity"
       }
     ]
   }
   ```

   **Option B: Index File**
   Create `.claude/commands/index.md` listing all commands.

   **Option C: Framework Init Command**
   ```bash
   claude-code --load-commands .claude/commands/
   ```

3. Test and document working solution

## Status
- [ ] Week 1: Investigation and testing
- [ ] Week 2: Implement solution
- [ ] Week 2: Update documentation
```

**Success Metric:** Commands work out of the box in new projects

#### Solution 5.2: Standardized Agent Memory (CON-08)
**Implementation:**
```markdown
# Documentation update: .claude/docs/agent-memory-guidelines.md

## Agent Memory Guidelines

**Rule:** Agents should NOT create separate memory files.

**Instead:**
- Use `.claude/specs/*` for persistent context (architecture, requirements)
- Use `.claude/plans/current-task.md` for session state
- Update existing artifacts, don't create new summaries

**Example:**
❌ Don't: Create `PROJECT_INITIALIZATION_SUMMARY.md` in root
✅ Do: Update `.claude/specs/implementation-notes.md`

## Artifact Ownership

| File | Owned By | Purpose |
|------|----------|---------|
| `.claude/specs/requirements.md` | PM | User requirements |
| `.claude/specs/architecture.md` | Architect | Technical design |
| `.claude/specs/tech-stack.md` | Architect | Technology choices |
| `.claude/specs/test-strategy.md` | Tester | Test plans |
| `.claude/specs/security-findings.md` | Security Auditor | Security audit results |
| `.claude/plans/current-task.md` | Commands (auto) | Session state |
```

**Success Metric:** No ad-hoc memory files created, artifacts used consistently

#### Solution 5.3: Backlog Management (CON-04)
**Implementation:**
```markdown
# Update .claude/agents/product-manager.md

## Responsibilities (NEW)

**Backlog Management:**
After creating requirements, automatically create/update:

`.claude/plans/backlog.md`:
```markdown
# Feature Backlog

## Phase 1 (Current Release)
- [x] User authentication
- [x] Task CRUD operations
- [ ] Task filtering

## Phase 2 (Next Release)
- [ ] Task templates
- [ ] Multi-tenancy
- [ ] Real-time notifications

## Parking Lot (Future Consideration)
- [ ] Audit logging
- [ ] Advanced reporting
- [ ] Mobile app

## Open Questions
- How to handle time zones for due dates?
- Should we support recurring tasks?
- What's the data retention policy?
```
```

**Success Metric:** All "nice to have" features tracked in backlog

#### Solution 5.4: Agent Time Awareness (CON-05)
**Implementation:**
```markdown
# Add to all agent prompts

## Context

**Current Date:** {CURRENT_DATE} (auto-injected by system)

IMPORTANT: Use latest versions and best practices as of this date.
Do not recommend deprecated packages or outdated patterns.
```

**Monitoring:**
- Document expected behavior
- Log instances where wrong date caused issues
- No action unless actual problems occur

**Success Metric:** Agents use current best practices

---

## Prioritized Implementation Roadmap

### Phase 1: Token Optimization (Week 1-2) - CRITICAL
**Goal:** 60-85% token reduction

#### Week 1
- [x] CON-12: Agent file content caching
  - Design cache structure
  - Implement Read tool cache checking
  - Add cache invalidation
  - Test with single agent

- [x] CON-17: Command-level artifact cache
  - Load specs once at command start
  - Implement artifact compression
  - Inject into all agent contexts
  - Add version tracking

- [x] CON-02: Investigate slash command loading
  - Research Claude Code discovery
  - Test solutions
  - Document findings

#### Week 2
- [ ] CON-16: File tree context provider
  - Generate project tree at start
  - Create FilesystemQuery tool
  - Update agents to use tree
  - Measure Bash reduction

- [ ] CON-11: Enforce architect specs-only
  - Update architect agent constraints
  - Test with benchmark
  - Verify no code rework

- [ ] Mini-benchmark test
  - Run subset of tasks
  - Measure token reduction
  - Verify no regressions

**Expected Outcome:** 60-85% token reduction achieved

---

### Phase 2: Quality Gates (Week 3) - CRITICAL
**Goal:** 100% Testing + Security coverage

#### Week 3
- [ ] CON-19: Mandatory Tester agent
  - Create tester agent definition
  - Update all implementation commands
  - Add test-first workflow variant
  - Implement coverage tracking

- [ ] CON-20: Mandatory Security Auditor
  - Create security audit checklist
  - Identify phases requiring audit
  - Implement blocking on critical findings
  - Add audit to workflow

- [ ] CON-25: Enforced quality gates
  - Implement phase gating system
  - Define passing criteria per phase
  - Block progression on failures

- [ ] CON-18: Balance workflow
  - Add Code Reviewer agent
  - Add Documenter agent
  - Ensure 1:1 Engineer:Tester ratio

**Expected Outcome:** 100% Testing + Security coverage, balanced workflow

---

### Phase 3: Observability (Week 4) - HIGH
**Goal:** Complete metadata export for debugging

#### Week 4
- [ ] CON-13: Explicit agent role metadata
  - Add role field to all agents
  - Update session exports
  - Create role taxonomy
  - Test role-based filtering

- [ ] CON-14: Retry tracking metadata
  - Export retry reason, parent agent
  - Track parent-child relationships
  - Test bounded reflexion tracking

- [ ] CON-22: Structured error logging
  - Implement agent_errors, tool_errors
  - Add retry_triggers logging
  - Export error recovery patterns

- [ ] CON-15, CON-21: Efficiency metrics
  - Track operation counts
  - Flag minimal invocations
  - Monitor Write/Edit ratios
  - Export efficiency warnings

**Expected Outcome:** 100% agent role identification, complete error tracking

---

### Phase 4: Session Management (Week 5) - HIGH
**Goal:** Resume capability and automation

#### Week 5
- [ ] CON-06: Task tracking system
  - Implement current-task.md auto-updates
  - Create checkpoint system
  - Test state persistence

- [ ] CON-09: Resume command
  - Create /project:resume command
  - Implement context reloading
  - Test after interruption

- [ ] CON-01: Auto-populate CLAUDE.md
  - Update /project:start command
  - Architect updates CLAUDE.md
  - Test synchronization

- [ ] CON-03: Automated metrics
  - Implement workflow-metrics.json
  - Auto-track all events
  - Create analysis script

- [ ] CON-07: Git automation
  - Update DevOps agent
  - Implement conventional commits
  - Add branch strategy

**Expected Outcome:** Full resume capability, automated workflows

---

### Phase 5: Foundation & Polish (Week 6) - MEDIUM/LOW
**Goal:** Clean up infrastructure issues

#### Week 6
- [ ] CON-02: Slash command solution
  - Implement solution from investigation
  - Test in new project
  - Document usage

- [ ] CON-08: Standardize agent memory
  - Document guidelines
  - Update agent prompts
  - Move existing summaries to specs

- [ ] CON-04: Backlog management
  - Update PM agent
  - Create backlog.md template
  - Test with new project

- [ ] CON-23, CON-24: Remaining items
  - Add parallel coordination metadata
  - Ensure documenter invoked per phase

**Expected Outcome:** Clean, well-documented framework

---

### Phase 6: Validation & Release (Week 7)
**Goal:** Comprehensive validation

#### Week 7
- [ ] Full benchmark comparison
  - Run identical task with v0.3
  - Measure ALL metrics vs v0.2
  - Document improvements
  - Verify success criteria

- [ ] Documentation
  - Update CLAUDE.md with v0.3 features
  - Update benchmark guide
  - Create migration guide
  - Update all agent/command docs

- [ ] Release
  - Tag v0.3 release
  - Create release notes
  - Announce improvements

**Expected Outcome:** v0.3 release with quantified improvements

---

## Success Criteria (Must Meet ALL)

### Token Efficiency (CRITICAL)
- ✅ Operations reduced by ≥60% (1,179 → <470)
- ✅ File redundancy <1.5x (currently 4.3x)
- ✅ Bash discovery reduced by ≥50% (122 → <60)
- ✅ Core specs read max 3 times total (not 28)

### Quality Coverage (CRITICAL)
- ✅ 100% of implementation phases have Tester agent
- ✅ 100% of auth/data phases have Security Auditor
- ✅ Test coverage >80%
- ✅ 0 critical security findings

### Metadata Completeness (HIGH)
- ✅ 100% of agents have role metadata
- ✅ All retries tracked with reason
- ✅ All errors categorized and logged
- ✅ Efficiency anomalies flagged

### User Experience (HIGH)
- ✅ Resume capability functional
- ✅ Task tracking persists across sessions
- ✅ CLAUDE.md auto-populated
- ✅ Slash commands work out of the box

### Workflow Balance (MEDIUM)
- ✅ Engineer:Tester ratio ≈ 1:1 per phase
- ✅ Documentation agent per phase
- ✅ Systematic git commits

### No Regressions
- ✅ All v0.2 tests still pass
- ✅ All v0.2 features still work
- ✅ Benchmark completion time same or better

---

## Risk Assessment & Mitigation

### High Risk Items

**CON-02 (Slash Commands)**
- **Risk:** May require Claude Code core changes beyond our control
- **Mitigation:**
  - Investigate early (Week 1)
  - Have fallback: Manual command discovery documentation
  - Escalate to Claude Code team if needed

**CON-10/12/17 (Token Optimization)**
- **Risk:** May require significant refactoring, breaking changes
- **Mitigation:**
  - Profile token usage first
  - Implement incrementally
  - Test each optimization independently
  - Have rollback plan

### Medium Risk Items

**CON-06/09 (Resume Capability)**
- **Risk:** Complex state management, edge cases
- **Mitigation:**
  - Start with simple checkpoint system
  - Iterate based on testing
  - Clear documentation for manual resume

**CON-19/20 (Quality Gates)**
- **Risk:** May slow down workflows significantly
- **Mitigation:**
  - Use haiku model for simple validation
  - Parallelize where possible
  - Monitor performance impact

### Low Risk Items
- All other considerations have clear solutions and low implementation risk

---

## Dependencies & Sequencing

### Must Be Done First
1. **CON-02 investigation** (Week 1) - Blocks all command usage
2. **CON-12, CON-17** (Week 1-2) - Foundation for token optimization
3. **CON-13** (Week 4) - Enables all other observability features

### Can Be Parallelized
- CON-16 (File tree) + CON-11 (Specs-only) in Week 2
- CON-19 (Tester) + CON-20 (Security) in Week 3
- CON-14, CON-22 (Tracking) in Week 4
- CON-06, CON-09 (Resume) in Week 5

### Must Be Done Last
- CON-09 (Resume) depends on CON-06 (Task tracking)
- Final benchmark (Week 7) depends on all prior work

---

## Resource Requirements

### Development Time
- **Week 1-2:** Token Optimization (2 weeks)
- **Week 3:** Quality Gates (1 week)
- **Week 4:** Observability (1 week)
- **Week 5:** Session Management (1 week)
- **Week 6:** Foundation (1 week)
- **Week 7:** Validation (1 week)
- **Total:** 7 weeks

### Testing Time
- Mini-benchmark (Week 2): 2-3 hours
- Full benchmark (Week 7): 4-6 hours
- Regression testing: Throughout

### Documentation Time
- Inline documentation: Throughout
- Final docs update: Week 7 (1 week)

### Tools Needed
- Claude Code (latest version)
- Docker (for benchmarks)
- Git (version control)
- Python 3.x (for session analysis scripts)
- jq (for JSON processing)
- Node.js (for test benchmark)

---

## Rollback Plan

### If Critical Issues Arise

**Severity Assessment:**
1. **CRITICAL:** Breaks framework, cannot complete tasks
   - Action: Immediate rollback to v0.2
   - Process: `git checkout feature/beta-v0.2`, redeploy

2. **HIGH:** Functionality degraded, workarounds exist
   - Action: Fix forward in v0.3.1
   - Process: Hot-patch specific issue

3. **MEDIUM:** Edge cases, minor issues
   - Action: Document workaround, fix in v0.3.1
   - Process: Add to known issues

### Rollback Procedure
1. Identify regression through benchmark comparison
2. Isolate problematic feature package
3. Cherry-pick safe commits, revert problematic ones
4. Re-test with mini-benchmark
5. Document issue in benchmark-learnings.md
6. Schedule fix for next iteration

---

## Communication Plan

### Stakeholders
- Framework users (developers using Claude Code framework)
- Framework developers (core team)
- Benchmark testers

### Update Cadence
- **Weekly:** Progress update on GitHub/Slack
  - What was completed
  - Blockers encountered
  - Next week's plan

- **Milestone:** When each phase completes
  - Summary of changes
  - Metrics achieved
  - Known issues

- **Release:** v0.3 announcement
  - Full changelog
  - Migration guide
  - Benchmark results comparison

### Channels
- GitHub: Issues, PRs, release notes
- Documentation: Updated README, CLAUDE.md
- Slack/Discord: Real-time updates

---

## Metrics to Track (Before vs After)

### Baseline (v0.2)
```
Token Efficiency:
- Operations: 1,179
- File redundancy: 4.3x
- Bash commands: 122
- Spec re-reads: 28

Quality Coverage:
- Tester agents: 0
- Security auditor agents: 0
- Test coverage: Unknown
- Documentation agents: 0

Observability:
- Agents with roles: ~50%
- Retry tracking: 0%
- Error categorization: 0%

User Experience:
- Resume capability: ❌
- Task tracking: ❌
- CLAUDE.md auto-fill: ❌
- Slash commands auto-load: ❌
```

### Target (v0.3)
```
Token Efficiency:
- Operations: <470 (60% reduction)
- File redundancy: <1.5x
- Bash commands: <60 (50% reduction)
- Spec re-reads: 3 (90% reduction)

Quality Coverage:
- Tester agents: 100% of phases
- Security auditor agents: 100% of auth/data phases
- Test coverage: >80%
- Documentation agents: 100% of phases

Observability:
- Agents with roles: 100%
- Retry tracking: 100%
- Error categorization: 100%

User Experience:
- Resume capability: ✅
- Task tracking: ✅
- CLAUDE.md auto-fill: ✅
- Slash commands auto-load: ✅
```

---

## Next Immediate Actions

### This Week (Week 1)
1. ✅ Complete consolidated roadmap (this document)
2. ⏳ Begin CON-12 implementation (agent file caching)
3. ⏳ Begin CON-17 implementation (artifact cache)
4. ⏳ Begin CON-02 investigation (slash commands)
5. ⏳ Set up development branch: `feature/v0.3-token-optimization`

### Next Week (Week 2)
1. ⏳ Complete Phase 1: Token Optimization
2. ⏳ Run mini-benchmark
3. ⏳ Measure token reduction achieved
4. ⏳ Adjust targets based on results

---

## Conclusion

This consolidated roadmap addresses **ALL 25 considerations** discovered through comprehensive analysis. By grouping issues into **5 feature packages** and implementing across **7 phases**, we will achieve:

**Primary Goals:**
- 60-85% token reduction (CON-10, 12, 16, 17)
- 100% Testing + Security coverage (CON-19, 20, 25)
- Complete observability (CON-13, 14, 22)
- Full resume capability (CON-06, 09)
- Production-ready workflows

**Evidence-Based Approach:**
Every recommendation backed by quantified data from 18-agent transcript analysis:
- 4.3x file redundancy measured
- 122 Bash commands counted
- 28 redundant spec reads documented
- 0 Tester/Security agents observed

**Expected Impact:**
- Operations: 1,179 → <470 (60% minimum reduction)
- Cost: Proportional to operation reduction
- Quality: Systematic Testing + Security
- Experience: Seamless resume + automation

**Ready to Begin:** Phase 1 starts Week 1 with token optimization foundation.

---

**Document Version:** 1.0 (Consolidated from all 25 considerations)
**Created:** 2025-12-06
**Status:** APPROVED - Ready for Implementation
**Owner:** Framework Development Team
**Next Review:** After Phase 1 completion (Week 2)
